<?xml version="1.0" encoding="UTF-8"?>
<rules
    xmlns="http://namespaces.plone.org/diazo"
    xmlns:css="http://namespaces.plone.org/diazo/css"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    css:if-content="#visual-portal-wrapper">

    <theme href="home.html" css:if-content="body.section-front-page"/>
    <theme href="index.html"/>

    <notheme if-path="presentation_view"/>
    <notheme if-path="source_editor.htm"/>
    <notheme if-path="ploneimage.htm"/>
    <notheme if-path="anchor.htm"/>
    <notheme if-path="table.htm"/>
    <notheme if-path="attributes.htm"/>

    <replace theme="/html/head/title" content="/html/head/title"/>
    <replace theme="/html/head/base" content="/html/head/base" />

    <!-- add only plone javascript -->
    <!--    <append theme='/html/head' content='/html/head/script'/>-->

    <!-- for cmsui -->
    <before css:theme-children="body" css:content="#plone-cmsui-trigger" />

    <copy attributes="class" css:content="body" css:theme="body"/>
    <copy attributes="id dir" css:content="body" css:theme="body"/>

    <!-- Logo (link target) -->
    <copy attributes="href title" css:content='#portal-logo' css:theme="#portal-logo a" />

    <!-- globalnav -->
    <copy content='//*[@id="portal-globalnav"]' theme='//*[@id="portal-globalnav"]' />
    <replace css:content="#portal-globalnav li">
        <xsl:for-each css:select="li">
          <li><xsl:copy-of select="./@*" />
              <span class="tabLabel">.<xsl:copy-of select="a/text()"/></span>
              <xsl:copy-of select="a"/>
          </li>
        </xsl:for-each>
    </replace>

    <!-- book search form -->
    <replace content='//*[@name="searchform"]' theme='//*[@id="livesearch0"]' />
    <copy attributes="href" content='//*[@rel="search"]' css:theme="dl.portletSearch a.moreLink" />

    <!-- calendar portlet -->
    <copy css:content-children='dl.portletCalendar' css:theme='dl.portletCalendar' />

    <!-- events portlet -->
    <copy css:content-children='dl.portletEvents' css:theme='dl.portletCollectionEvents' />

    <!-- right portlets -->
    <replace css:content="#portal-column-two div dl">
      <xsl:for-each css:select="dl">
        <xsl:if test="not(contains(@class,'portletCalendar')) 
                      and not(contains(@class,'portletEvents'))">
          <xsl:copy-of select="." />
          <hr class="blocksSep" />
        </xsl:if>
      </xsl:for-each>
    </replace>
    <replace content-children='//*[@id="portal-column-two"]' theme-children='//*[@id="portal-column-two"]' />

    <!-- center column -->
    <copy content-children='//*[@id="portal-column-content"]' theme='//*[@id="portal-column-content"]' />

    <!-- site actions -->
    <copy content-children='//*[@id="portal-siteactions"]' theme='//*[@id="portal-siteactions"]' />


</rules>
