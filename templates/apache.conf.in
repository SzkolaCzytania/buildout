<VirtualHost *:80>
  ServerName testing.szkolaczytania.org.pl
  ServerAlias admin.szkolaczytania.org.pl

  DocumentRoot /var/www/
  CustomLog "|/usr/local/sbin/cronolog --symlink=/var/log/apache2/http-szcz-access.log /var/log/apache2/%Y/%m/%d/http-szcz-access.log" combined
  ErrorLog  "|/usr/local/sbin/cronolog --symlink=/var/log/apache2/http-szcz-error.log  /var/log/apache2/%Y/%m/%d/http-szcz-error.log"

  RewriteEngine On
  ProxyRequests Off

  <Proxy http://${varnish:bind}/*>
    Order deny,allow
    Deny from all
    Allow from all
  </Proxy>

  RewriteRule ^/app_login(.*)$  http://%{SERVER_NAME}:80/app_status [R]
  RewriteRule ^/app_register(.*)$  http://%{SERVER_NAME}:80/app_status [R]
  RewriteRule ^/(.*)$  http://${varnish:bind}/VirtualHostBase/http/%{SERVER_NAME}:80/szcz/VirtualHostRoot/$1 [L,P]
  ProxyPassReverse / http://${varnish:bind}/

</VirtualHost>

<VirtualHost *:80>
  ServerName www.szkolaczytania.org.pl
  DocumentRoot /var/www/szcz/

<Directory /var/www/szcz/>
  Options -Indexes FollowSymLinks MultiViews
  AllowOverride All
  Order allow,deny
  allow from all
</Directory>

</VirtualHost>
